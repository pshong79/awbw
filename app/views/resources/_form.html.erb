<%= simple_form_for @resource, wrapper: :tailwind_form do |f| %>
  <%= render 'shared/errors', resource: @resource if @resource.errors.any? %>

  <!-- First Row -->
  <div class="title-row flex flex-wrap gap-4 mb-4">
    <div class="flex-1 min-w-[200px]">
      <%= f.input :title,
                  as: :text,
                  input_html: { rows: 1, class: "w-full rounded border-gray-300 font-bold text-md" },
                  wrapper: false,
                  label_html: { class: 'block font-medium mb-1' } %>
    </div>

    <div class="flex-1 min-w-[200px]">
      <%= f.input :kind,
                  as: :select,
                  collection: Resource::KINDS,
                  input_html: { class: "w-full rounded border-gray-300" } %>
    </div>

    <% if request.path != workshops_share_idea_path %>
      <div class="flex-1 min-w-[200px]">
        <label class="block font-medium mb-1">Flags</label>
        <div class="flex items-center gap-6">
          <div>
            <%= f.input :featured, as: :boolean, wrapper: false, label_html: { class: "inline" } %>
          </div>
          <div>
            <%= f.input :inactive, as: :boolean, wrapper: false, label_html: { class: "inline" } %>
          </div>
        </div>
      </div>
    <% else %>
      <%= f.hidden_field :inactive, value: true %>
    <% end %>
  </div>

  <!-- Second Row -->
  <div class="text-row flex flex-wrap gap-4 mb-4">
    <div class="flex-1 min-w-[200px]">
      <%= f.input :text,
                  as: :text,
                  input_html: { rows: 5, class: "w-full rounded border-gray-300" } %>
    </div>
  </div>

  <!-- Second Row -->
  <div class="url-row flex flex-wrap gap-4 mb-4">
    <!-- URL Input: max half width -->
    <div class="flex-[0_0_50%] min-w-[150px]">
      <%= f.input :url,
                  as: :text,
                  input_html: { class: "w-full rounded border-gray-300 px-2 py-1",
                                rows: 1 },
                  label_html: { class: "font-medium mb-1 block" } %>
    </div>

    <!-- Ordering Input -->
    <div class="flex-[0_0_150px]">
      <%= f.input :ordering,
                  as: :integer,
                  label: "Display order",
                  input_html: { class: "w-full rounded border-gray-300 px-2 py-1", min: 1, step: 1 },
                  label_html: { class: "font-medium mb-1 block" } %>
    </div>
  </div>

  <!-- Third Row -->
  <div class="uploads-row flex flex-wrap gap-4 mb-4">
    <!-- Main Image -->
    <div class="flex-1 min-w-[200px] flex flex-col gap-2">
      <%= f.simple_fields_for :images, f.object.images.first || f.object.images.build do |mi| %>
        <div class="nested-fields flex flex-col gap-2">
          <div class="mb-4">
            <%= mi.label :file, "Main Image", class: "block mb-1 font-medium text-gray-700" %>
            <label class="relative cursor-pointer inline-block w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2 hover:border-gray-400">
              <%= mi.file_field :file, class: "absolute inset-0 w-full h-full opacity-0 cursor-pointer" %>
              <span class="pointer-events-none text-gray-700">Choose new file</span>
            </label>
            <%= mi.error :file, wrap_with: { tag: :p, class: "text-red-500 text-sm mt-1" } %>
            <%= mi.hint :file, wrap_with: { tag: :p, class: "text-gray-500 text-sm mt-1" } %>
          </div>

          <% if mi.object.persisted? && mi.object.file.present? %>
            <div class="flex flex-col items-center mb-4">
              <div class="w-full max-w-[250px] h-[250px] overflow-hidden rounded-md border mb-2">
                <%= image_tag mi.object.file.url(:medium),
                              alt: "Main Image",
                              class: "w-full h-full object-contain rounded-md" %>
              </div>

              <%= mi.input :_destroy, as: :boolean,
                           label: "Remove",
                           wrapper_html: { class: "flex justify-center items-center mb-0" },
                           label_html: { class: "text-sm text-gray-700 ml-2" } %>
            </div>
          <% end %>

        </div>
      <% end %>
    </div>

    <!-- Attachment -->
    <div class="flex-1 min-w-[200px] flex flex-col gap-2">
      <%= f.simple_fields_for :attachments, f.object.attachments.first || f.object.attachments.build do |att| %>
        <div class="nested-fields flex flex-col gap-2">
          <div class="mb-4">
            <%= att.label :file, "Attachment", class: "block mb-1 font-medium text-gray-700" %>
            <label class="relative cursor-pointer inline-block w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2 hover:border-gray-400">
              <%= att.file_field :file, class: "absolute inset-0 w-full h-full opacity-0 cursor-pointer" %>
              <span class="pointer-events-none text-gray-700">Choose new file</span>
            </label>
            <%= att.error :file, wrap_with: { tag: :p, class: "text-red-500 text-sm mt-1" } %>
            <%= att.hint :file, wrap_with: { tag: :p, class: "text-gray-500 text-sm mt-1" } %>
          </div>

          <% if att.object.persisted? && att.object.file.present? %>
            <div class="flex flex-col items-center mb-4">
              <% if att.object.file_content_type.start_with?('image/') %>
                <div class="w-full max-w-[200px] h-[150px] overflow-hidden rounded-md border mb-2">
                  <%= image_tag att.object.file.url(:medium),
                                alt: "Attachment",
                                class: "w-full h-full object-contain rounded-md" %>
                </div>
              <% else %>
      <span class="text-lg text-gray-700 mb-2 block text-center">
        <%= att.object.file_file_name %>
      </span>
              <% end %>

              <%= att.input :_destroy, as: :boolean,
                            label: "Remove",
                            wrapper_html: { class: "flex justify-center items-center mb-0" },
                            label_html: { class: "text-sm text-gray-700 ml-2" } %>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>



  <!-- Form Actions -->
  <div class="flex gap-2 mt-4">
    <%= link_to_button "Delete", @resource, variant: :danger_outline, method: :delete, data: { confirm: "Are you sure?" } %>
    <%= link_to_button 'Cancel', resources_path, variant: :secondary_outline %>
    <%= f.submit 'Submit',
                 class: "px-4 py-2 border border-blue-600 hover:text-gray-600 hover:bg-white
                 rounded-lg bg-blue-600 text-white text-sm font-medium" %>
  </div>
<% end %>

<script>
    document.addEventListener("turbo:load", () => {
        document.querySelectorAll('input[type="file"]').forEach(input => {
            input.addEventListener('change', () => {
                const label = input.closest('label'); // find parent label
                if (!label) return;

                const span = label.querySelector('span');
                if (span) {
                    span.textContent = input.files.length > 0 ? input.files[0].name : "Choose new file";
                }
            });
        });
    });
</script>
