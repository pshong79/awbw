<div class="w-full px-4 search-resources-page">
  <!-- Header Row -->
  <div class="w-full">
    <div class="flex items-start justify-between mb-6">
      <div class="pr-6">
        <h2 class="text-2xl font-semibold mb-2">Resources</h2>
      </div>
      <% if current_user.super_user? %>
        <%= link_to_button 'New Resource', new_resource_path, variant: :primary_outline %>
      <% end %>
    </div>
  </div>

  <!-- Search Form -->
  <div class="w-full">
    <%= form_tag resources_path, method: :get, class: "space-y-2" do %>
      <input type="hidden" name="kind" value="<%= params[:kind] %>" />
      <!-- Filters Header -->
      <div>
        <h3 class="text-sm font-semibold uppercase text-gray-500 tracking-wide">Filters</h3>
      </div>

      <!-- Search Fields -->
      <div class="flex flex-col md:flex-row items-start md:items-end gap-6">

        <!-- Keywords -->
        <div class="keywords-search-box flex-1">
          <%#= label_tag :query, "Keywords", class: "block text-gray-700 font-medium mb-1" %>
          <div class="relative">
            <%= text_field_tag :query, params[:query],
                                placeholder: "Keywords",
                               class: "w-full bg-white border border-gray-300 rounded-lg px-3 py-2 pr-10
                               focus:ring-blue-500 focus:border-blue-500" %>
            <button type="submit"
                    class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700">
              <i class="fa fa-search"></i>
            </button>
          </div>
        </div>

        <!-- Filter Row -->
        <% if params[:kind] != "Scholarship" %>
          <div class="flex items-center gap-2">
            <%= render "search_boxes_kinds", sortable_fields: Resource::KINDS - ["Story"] %>
          </div>
        <% end %>

        <!-- Clear Filters -->
        <div>
          <%= link_to_button 'Clear filters', resources_path, variant: :utility %>
        </div>

      </div>

    <% end %>

  </div>

  <!-- Divider -->
  <div class="w-full mt-6">
    <hr class="border-gray-300 mb-6">
  </div>

  <!-- Results Table -->
  <% if @resources.any? %>
    <div class="overflow-x-auto">
      <table class="min-w-full border-collapse">
        <tbody id="resources-list" class="divide-y divide-gray-200">
        <% @resources.each do |resource| %>
          <tr>
            <td class="py-3">
              <div class="flex items-center gap-3">
                <!-- Image -->
                <div class="image max-w-[60px] flex-shrink-0">
                  <%= link_to resource_path(resource) do %>
                    <img class="h-10 w-auto rounded-md object-cover"
                         src="<%= resource.main_image_url || asset_path('workshop_default.png') %>"
                         alt="<%= resource.title.truncate(25) %>"
                         onerror="this.onerror=null;this.src='<%= asset_path('workshop_default.png') %>';
                                  this.classList.add('w-auto', 'rounded-md', 'object-cover', 'object-contain');"
                      />
                  <% end %>
                </div>

                <!-- Title -->
                <div class="title">
                  <%= link_to resource.title.titleize, resource_path(resource),
                              class: "text-gray-900 hover:underline font-medium block" %>
                </div>

                <% unless resource.attachments.empty? %>
                  <!-- Download -->
                  <div class="download flex items-center gap-1">
                    <%= link_to_button "<span class='fa fa-download' title='#{resource.title}'</span>".html_safe,
                                       resource_download_path(resource),
                                       variant: :utility %>
                  </div>
                <% end %>
              </div>
            </td>

          </tr>
        <% end %>
        </tbody>
      </table>
    </div>
  <% else %>
    <p class="text-gray-500">There are no resources that match your search. Please try again.</p>
  <% end %>

  <!-- Pagination -->
  <div class="pagination mt-6">
    <div class="pagination mt-6">
      <%= will_paginate @resources,
                        previous_label: '<<',
                        next_label: '>>',
                        inner_window: 2,
                        class: 'will-paginate-wrapper flex space-x-2 list-none p-0' %>
    </div>
  </div>

</div>

<script>
  $('#submit-div').click(function() {
   $('form').submit();
  });
</script>

