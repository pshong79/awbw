<div
  class="
    search-curriculum-page max-w-7xl mx-auto bg-white border border-gray-200
    rounded-xl shadow p-6
  "
>
  <!-- Header -->
  <div class="w-full">
    <div class="flex items-start justify-between mb-6">
      <div class="pr-6">
        <h2 class="text-2xl font-semibold mb-2">Workshops</h2>
        <p class="text-gray-700">
          Search by emotional theme, materials needed, ease of set-up and
          clean-up, and more.
          <br>
          We always encourage the creativity and innovation of each Windows
          Facilitator; if you adapt and improve workshops, please be sure to
          share your ideas with us!
        </p>
      </div>
      <% if current_user.super_user? %>
        <div class="admin-only bg-blue-100 p-3">
          <%= link_to "New workshop", new_workshop_path, class: "btn btn-primary-outline" %>
        </div>
      <% end %>
    </div>
  </div>
  <!-- Divider -->
  <div class="w-full">
    <hr class="border-gray-300 mb-6">
  </div>
  <!-- Search Form -->
  <div class="w-full">
    <%= form_tag('/workshops', method: :get, class: "space-y-6") do %>
      <%= render "filters" %>
      <div>
        <hr class="border-gray-300 my-6">
      </div>
      <div class="mt-6">
        <%= render "filters_applied" %>
      </div>
      <div>
        <hr class="border-gray-300 my-6">
      </div>

      <!-- Sort Options -->
      <div class="flex flex-wrap items-center gap-x-4 gap-y-2 font-medium">
        <h3 class="text-sm font-semibold uppercase text-gray-500 tracking-wide">Sort by</h3>
        <%= render "sort_by_options" %>
      </div>

      <div>
        <hr class="border-gray-300 my-6">
      </div>

      <!-- Workshops List -->
      <div class="mt-6">
        <% if @workshops.any? %>
          <div id="workshops-list" class="space-y-4">
            <% @workshops.each do |workshop| %>
              <%= render "workshops/index_row",
              workshop: workshop.decorate,
              breadcrumb: "Workshops",
              link_route: workshop_path(workshop) %>
            <% end %>
          </div>

          <div class="pagination mt-6">
            <%= will_paginate @workshops,
            previous_label: "<<",
            next_label: ">>",
            inner_window: 2,
            class: "will-paginate-wrapper flex space-x-2 list-none p-0" %>
          </div>

        <% else %>
          <p class="text-gray-600">Your search returned no results. Please try again.</p>
        <% end %>
      </div>
    <% end %>
  </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        document.querySelectorAll(".category-checkbox").forEach(function(checkbox) {
            checkbox.addEventListener("change", function() {
                this.form.submit();
            });
        });
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const resultsDiv = document.getElementById("workshops-list");

        // Only scroll if the element exists and we have query/sort params
        if (resultsDiv && (new URLSearchParams(window.location.search).has('query') ||
            new URLSearchParams(window.location.search).has('sort'))) {

            // Use a timeout to ensure the element is fully rendered
            setTimeout(() => {
                const headerOffset = 275; // adjust to your header height + buffer
                const elementPosition = resultsDiv.getBoundingClientRect().top + window.scrollY;
                const offsetPosition = elementPosition - headerOffset;

                window.scrollTo({
                    top: offsetPosition,
                    behavior: "smooth"
                });
            }, 50); // small delay
        }
    });
</script>
