<div class="w-full mx-auto">
  <%= simple_form_for @workshop do |f| %>
    <!-- Errors -->
    <% if workshop.errors.any? %>
      <%= render 'shared/tailwind/errors', resource: workshop %>
    <% end %>

    <!-- Row 1 -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
      <div>
        <%= f.input :title,
                    as: :text,
                    label: "Workshop title",
                    input_html: { rows: 2, class: "block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm" },
                    wrapper: false,
                    label_html: { class: 'block text-sm font-medium text-gray-700 mb-1' } %>
      </div>

      <div>
        <%= f.input :windows_type_id,
                    as: :select,
                    label: "Workshop type",
                    required: true,
                    collection: WindowsType.pluck(:name, :id).sort_by(&:first),
                    selected: @workshop.windows_type_id || WindowsType.where("name like 'adult%'").last&.id,
                    input_html: { class: "block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm" } %>
      </div>

      <% if request.path == workshops_share_idea_path %>
        <%= f.hidden_field :inactive, value: true %>
      <% elsif current_user.super_user? %>
        <div class="admin-only bg-blue-100">
          <label class="block text-sm font-medium text-gray-700 mb-1">Flags</label>
          <div class="flex gap-x-6 items-center">
            <%= f.input :featured, as: :boolean, wrapper: false %>
            <%= f.input :inactive, as: :boolean, label: "Not published (inactive)", wrapper: false %>
          </div>
        </div>
      <% end %>
    </div>

    <!-- Row 2 -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
      <%= f.input :objective, as: :text, label: "Workshop objective",
                  placeholder: "Indicate goals of the workshop",
                  input_html: { rows: 1, class: "block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm" } %>

      <% if current_user.super_user %>
        <div class="admin-only bg-blue-100 flex gap-x-2 items-center">
          <%= f.input :full_name, as: :text, label: "Author's first & last name",
                      input_html: { rows: 1, class: "block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm" } %>
          <%= f.input :user_id,
                      as: :select,
                      label: "Author",
                      collection: User.order(:last_name, :first_name),
                      input_html: { class: "block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm" } %>
        </div>
      <% else %>
        <%= f.hidden_field :user_id, value: current_user&.id %>
      <% end %>

      <%= f.input :age_range, as: :select,
                  collection: @age_ranges,
                  input_html: { class: "block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm" } %>
    </div>

    <!-- Row 3 -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
      <%= f.input :materials, as: :text, label: "Materials needed",
                  placeholder: "List all materials needed to create the workshop",
                  input_html: { rows: 2, class: "block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm" } %>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Timeframe/duration</label>
        <div class="flex gap-x-2">
          <%= f.input :time_hours, as: :select, label: false,
                      collection: (0..5).to_a, prompt: "Hour",
                      input_html: { class: "block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm" } %>
          <%= f.input :time_minutes, as: :select, label: false,
                      collection: [0, 15, 30, 45], prompt: "Minutes",
                      input_html: { class: "block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm" } %>
        </div>
      </div>

      <%= f.input :setup, as: :text, label: "Set Up Instructions",
                  placeholder: "Include any tips needed to prep the workshop",
                  input_html: { rows: 2, class: "block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm" } %>
    </div>

    <!-- Demonstration / Warm-up / Creation / Closing -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-6">
      <!-- Demonstration -->
      <div class="flex gap-2">
        <div class="flex-1">
          <%= f.input :demonstration,
                      as: :text,
                      label: "Demonstration Instructions",
                      placeholder: "Include a description of a demonstration of the activity",
                      input_html: { rows: 2,
                                    class: "w-full border rounded-md p-2 focus:ring focus:ring-blue-500" } %>
        </div>
        <div class="w-24">
          <%= f.input :time_demonstration,
                      label: "Minutes",
                      input_html: { class: "w-full border rounded-md p-2 focus:ring focus:ring-blue-500" } %>
        </div>
      </div>

      <!-- Warm Up -->
      <div class="flex gap-2">
        <div class="flex-1">
          <%= f.input :warm_up,
                      as: :text,
                      label: "Warm-up / relaxation / meditation",
                      placeholder: "Include a warm-up or relaxation activity",
                      input_html: { rows: 2,
                                    class: "w-full border rounded-md p-2 focus:ring focus:ring-blue-500" } %>
        </div>
        <div class="w-24">
          <%= f.input :time_warm_up,
                      label: "Minutes",
                      input_html: { class: "w-full border rounded-md p-2 focus:ring focus:ring-blue-500" } %>
        </div>
      </div>

      <!-- Creation -->
      <div class="flex gap-2">
        <div class="flex-1">
          <%= f.input :creation,
                      as: :text,
                      label: "Creation",
                      placeholder: "Step by step how to create the workshop",
                      input_html: { rows: 3,
                                    class: "w-full border rounded-md p-2 focus:ring focus:ring-blue-500" } %>
        </div>
        <div class="w-24">
          <%= f.input :time_creation,
                      label: "Minutes",
                      input_html: { class: "w-full border rounded-md p-2 focus:ring focus:ring-blue-500" } %>
        </div>
      </div>

      <!-- Closing -->
      <div class="flex gap-2">
        <div class="flex-1">
          <%= f.input :closing,
                      as: :text,
                      label: "Closing",
                      placeholder: "Step by step how to close the workshop",
                      input_html: { rows: 3,
                                    class: "w-full border rounded-md p-2 focus:ring focus:ring-blue-500" } %>
        </div>
        <div class="w-24">
          <%= f.input :time_closing,
                      label: "Minutes",
                      input_html: { class: "w-full border rounded-md p-2 focus:ring focus:ring-blue-500" } %>
        </div>
      </div>
    </div>


    <!-- Notes / Tips / Date -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
      <%= f.input :notes, as: :text,
                  placeholder: "Anything else you'd like us to know",
                  input_html: { rows: 2, class: "block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm" } %>

      <%= f.input :tips, as: :text,
                  placeholder: "Any tips on how to make this workshop a success",
                  input_html: { rows: 2, class: "block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm" } %>

      <% if request.path == workshops_share_idea_path %>
        <%= f.hidden_field :month, value: Date.today.month %>
        <%= f.hidden_field :year, value: Date.today.year %>
      <% else %>
        <% if current_user.super_user %>
          <div class="admin-only bg-blue-100">
            <label class="block text-sm font-medium text-gray-700 mb-1">Date created</label>
            <div class="flex gap-x-2">
              <%= f.input :month, as: :select,
                          collection: Date::MONTHNAMES.compact.each_with_index.map { |m, i| [m, i + 1] },
                          selected: f.object.month || Date.today.month,
                          wrapper: false, label: false,
                          input_html: { class: "block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm" } %>
              <%= f.input :year,
                          as: :integer,
                          wrapper: false,
                          label: false,
                          input_html: {
                            value: f.object.year || Date.today.year,
                            class: "block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                          } %>
            </div>
          </div>
        <% end %>
      <% end %>


    </div>

    <div class="main-image">
      <div class="m-6"></div>

      <%= f.fields_for :images do |img_fields| %>
        <%= render 'image_fields', f: img_fields %>
      <% end %>
      <div class="mt-2">
        <%#= link_to_add_association "Add another Image", f, :images, partial: "image_fields", class: "text-blue-600 hover:underline" %>
      </div>
    </div>

    <!-- Accordions -->
    <div class="space-y-4">
      <div>
        <button type="button" class="w-full bg-gray-600 text-white px-3 py-2 rounded-t-md accordion-toggle">Spanish Translations</button>
        <div class="accordion-content hidden border border-gray-300 p-4 rounded-b-md">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <% workshop.decorate.display_spanish_fields.each do |field| %>
              <%= f.input field, as: :text,
                          input_html: { rows: 1, class: "block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm" } %>
            <% end %>
          </div>
        </div>
      </div>

      <div>
        <button type="button" class="w-full bg-gray-600 text-white px-3 py-2 rounded-t-md accordion-toggle">Series workshops</button>
        <div class="accordion-content <%= "hidden" unless f.object.workshop_series_children.any? %> border border-gray-300 p-4 rounded-b-md">
          <p class="mb-2 text-sm text-gray-600">
            If this Workshop is a series, add the other "series workshops" below.
            You can also add a series-specific description for each workshop in the series, and the order in which they should appear.
            (The main workshop description will appear if you don't add a "series description".)
          </p>
          <%= f.fields_for :workshop_series_children do |child_workshop_membership| %>
            <%= render "workshop_series_child_fields", f: child_workshop_membership %>
          <% end %>
          <div class="mt-2">
            <%= link_to_add_association "Add another Workshop to this Series", f, :workshop_series_children, partial: "workshop_series_child_fields", class: "text-blue-600 hover:underline" %>
          </div>
        </div>
      </div>
    </div>

    <!-- Actions -->
    <div class="flex gap-x-3 mt-6">
      <%= link_to "Delete", @workshop, class: "btn btn-danger-outline", method: :delete, data: { confirm: "Are you sure?" } %>
      <%= link_to "Cancel", (action_name == "share_idea" ? authenticated_root_path : workshops_path), class: "btn btn-secondary-outline" %>
      <%= f.submit "Submit", class: "btn btn-primary" %>
    </div>
  <% end %>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll('.accordion-toggle').forEach(toggle => {
            toggle.addEventListener('click', () => {
                const content = toggle.nextElementSibling;
                content.classList.toggle("hidden");
            });
        });
    });
</script>

<style>
 .accordion-toggle {
    width: 100%;
    background: #7C7C7C;
    color: white;
    padding: 8px 12px;
    border: none;
    text-align: left;
    cursor: pointer;
    border-top-left-radius: 4px;
    border-top-right-radius: 4px;
    margin-bottom: 2px;
    text-transform: none;
  }

 .accordion-toggle:hover {
    background: #ccc;
 }
</style>
