<%# ------------------------------------------
    Shared image upload section for any model
    Includes:
    - Main image (optional)
    - Gallery images
    - Add another file button (bottom-right)
   ------------------------------------------ %>

<% section_title       ||= "Images/attachments" %>
<% section_subtitle    ||= nil %>
<% include_main_image  ||= false %>

<div class="image-fields my-3">
  <hr class="my-6 border-gray-200">

  <h2 class="text-lg font-semibold text-gray-800 mb-2">
    <%= section_title %>
  </h2>

  <p class="text-sm text-gray-600 mb-3">
    ***If any image includes clients or client artwork, download
    the <a href="https://bit.ly/AWBWartmedia" target="_blank"
           class="text-blue-600 hover:underline">
    Art/Media Release</a> form.***
  </p>

  <div class="images bg-gray-50 border border-gray-200 rounded-md p-4 pb-0">

    <% if section_subtitle.present? %>
      <div class="mb-6"><%= section_subtitle %></div>
    <% end %>

    <!-- MAIN + GALLERY images all share this same flex row -->
    <div
      class="flex flex-wrap items-start content-start gap-6 image-fields-row"
      data-association-insertion-node="this"
      data-association-insertion-method="append">

      <%# ---- MAIN IMAGE ---- %>
      <% if include_main_image %>
        <%= f.fields_for :main_image do |img| %>
          <div class="flex flex-col text-left items-left gap-1 w-full md:w-1/3 lg:w-1/4 mb-6">
            <%= render "shared/form_image_field",
                       f: img,
                       resource: img.object,
                       label: "Main Image" %>
          </div>
        <% end %>
      <% end %>

      <%# ---- GALLERY IMAGES ---- %>
      <% counter = 1 %>
      <%= f.fields_for :gallery_images do |img| %>
        <div class="flex flex-col text-left items-left gap-1 w-full md:w-1/3 lg:w-1/4 mb-6">
          <%= render "shared/form_image_field",
                     f: img,
                     resource: img.object,
                     label: "Gallery Image #{counter}" %>
        </div>
        <% counter += 1 %>
      <% end %>

    </div>

    <!-- Add file button (bottom-right) -->
    <div class="mt-4 flex justify-end">
      <%= link_to_add_association "Add another file",
                                  f,
                                  :gallery_images,
                                  insertion_node: ".image-fields-row",
                                  insertion_method: :append,
                                  partial: "shared/form_image_field_insert",
                                  render_options: {
                                    locals: {
                                      label: "Additional gallery image",
                                      resource: f.object.gallery_images.build,
                                    }
                                  },
                                  class: "text-blue-600 hover:text-blue-800 font-medium text-sm pr-2 pb-6" %>
    </div>
  </div>
</div>
