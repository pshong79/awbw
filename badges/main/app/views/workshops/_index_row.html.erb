<% workshop_series_membership ||= nil %>
<% description_length ||= 600 %>
<% spanish ||= false %>
<% hide_tags ||= false %>

<% description =
     if workshop_series_membership
       workshop_series_membership.series_description_for(spanish: spanish, length: description_length)
     else
       workshop.formatted_objective(length: description_length)
     end %>

<div
  id="workshop-<%= workshop.id %>"
  class="
    flex flex-col sm:flex-row
    <%= "admin-only bg-blue-100" if workshop.inactive? %>
    border-b border-gray-200 bg-white py-4 gap-4
    px-4 sm:px-0">
  <div id="workshop-<%= workshop.id %>-anchor" style="position: relative; top: -200px;"></div>

  <!-- 1️⃣ Media -->
  <%= render "assets/display_image",
             resource: workshop,
             width: 32, height: 24,
             variant: :index,
             link_to_object: true,
             file: workshop.display_image %>


  <!-- Content (bookmark + title+ + description) -->
  <div class="flex flex-col sm:flex-row gap-4 flex-1">

    <!-- 2️⃣ Title / author / metadata -->
    <div class="flex flex-1 gap-4">

      <!-- Bookmark column (always visible, always left of title badges) -->
      <div class="flex-shrink-0 pt-1 w-6">
        <%= render "bookmarks/editable_bookmark_icon", resource: workshop.object %>
      </div>

      <!-- Title + badges + metadata -->
      <div class="flex flex-col gap-1 flex-1 min-w-0">

        <!-- Title with badges (single column, bookmark stays separate) -->
        <%= link_to link_route,
                    class: "hover:underline block",
                    data: { turbo_frame: "_top", turbo_prefetch: false } do %>
          <%= title_with_badges(workshop,
                                show_hidden_badge: current_user.super_user?,
                                display_windows_type: true).html_safe %>
        <% end %>

        <!-- Author + date -->
        <div class="text-sm text-gray-600 leading-tight">
          By:
          <% if workshop.user %>
            <%= link_to workshop.author_name,
                        generate_facilitator_user_path(workshop.user),
                        class: "hover:underline",
                        data: { turbo: false } %>
          <% else %>
            <%= workshop.full_name.present? ? workshop.full_name : "Facilitator" %>
          <% end %>
          | <%= workshop.date %>
        </div>

        <!-- Bookmarked count -->
        <%= tag.div id: dom_id(workshop, :bookmark_count),
                    class: "text-sm text-gray-600 leading-tight" do %>
          Bookmarked: <%= workshop.bookmarks_count %> <%= "time".pluralize(workshop.bookmarks_count.to_i) %>
        <% end %>

        <!-- Led count -->
        <%= tag.div id: dom_id(workshop, :led_count),
                    class: "text-sm text-gray-600 leading-tight" do %>
          Led: <%= workshop.led_count %> <%= "time".pluralize(workshop.led_count.to_i) %>
        <% end %>

        <!-- Age ranges -->
        <% if workshop.age_ranges.any? %>
          <div class="text-sm text-gray-600 leading-tight">
            Age ranges: <%= workshop.age_ranges.pluck(:name).to_sentence %>
          </div>
        <% end %>

      </div>
    </div>

    <!-- 3️⃣ Description -->
    <div class="flex flex-1 gap-4 pr-4 sm:pr-3">

      <!-- Empty placeholder where the bookmark column would be -->
      <div class="w-6 flex-shrink-0"></div>

      <!-- Actual description column -->
      <div class="flex-1 text-sm text-gray-700">
        <p class="workshop-description">
      <span title="<%= description %>">
        <%= sanitize(
              truncate(
                CGI.unescapeHTML(description),
                length: 215,
                omission: "... ",
                separator: " ",
                ),
              ) %>
      </span>
        </p>

        <% unless hide_tags %>
          <% if workshop.categories.any? %>
            <p class="tags mt-3 italic">
              Tags:
              <span title="<%= workshop.categories.map(&:name).to_sentence %>">
            <%= workshop.categories.map(&:name).to_sentence.truncate(150) %>
          </span>
            </p>
          <% end %>
        <% end %>

      </div>
    </div>

  </div>
</div>
