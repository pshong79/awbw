<% profile_url = @facilitator ? facilitator_url(@facilitator) : user_url(@user) %>

<p style="margin-bottom: 6px;">
  New <%= @noticeable.class.model_name.human.titleize %> <%= @type %>
</p>

<h1 style="margin: 0;">
  <strong><%= @user.name %></strong><br>
</h1>

<p style="margin: 4px 0 16px; font-size: 13px; color: #6b7280;">
  <span style="color:#6b7280; font-size: 0.9em;">
    Submitted on
  <%= @noticeable.created_at
                 .in_time_zone("Pacific Time (US & Canada)")
                 .strftime("%B %-d, %Y at %-l:%M %p %Z") %>
  </span>
</p>

<hr style="margin: 24px 0;">

<div style="text-align: left;">

  <% if @report.present? %>

    <!-- Report details -->
    <h2 style="margin-bottom: 8px; text-align: left;">
      Report details
    </h2>

    <table width="100%" cellpadding="0" cellspacing="0" style="margin-bottom: 24px;">
      <% if @report.respond_to?(:type) && @report.type.present? %>
        <tr>
          <td style="padding: 4px 0; color:#6b7280; width: 140px;">
            Report type
          </td>
          <td style="padding: 4px 0;">
            <strong><%= @report.type %></strong>
          </td>
        </tr>
      <% end %>

      <% if @noticeable.respond_to?(:windows_type) && @noticeable.windows_type.present? %>
        <tr>
          <td style="padding: 4px 0; color:#6b7280;">
            Service population
          </td>
          <td style="padding: 4px 0;">
            <strong><%= @noticeable.windows_type.short_name %></strong>
          </td>
        </tr>
      <% end %>
    </table>

    <!-- Form answers -->
    <% if @answers.present? %>
      <h2 style="margin-bottom: 8px; text-align: left;">
        Form answers
      </h2>

      <% @answers.each do |answer| %>
        <div style="margin-bottom: 18px; text-align: left;">
          <p style="margin: 0 0 4px 0; font-weight: bold;">
            <%= answer.name %>
          </p>
          <p style="margin: 0; color:#374151;">
            <%= answer.answer.presence || "—" %>
          </p>
        </div>
      <% end %>

      <hr style="margin: 24px 0;">
    <% end %>

    <!-- Quotes -->
    <% if @quotes.present? %>
      <h2 style="margin-bottom: 8px;">Quotes</h2>
      <% @quotes.decorate.each do |quote| %>
        <p style="margin-bottom: 12px;">
          “<%= quote.detail %>”
          <% if quote.attribution.present? %>
            <br>
            <span style="color:#6b7280; font-style: italic;">
              — <%= quote.attribution %>
            </span>
          <% end %>
        </p>
      <% end %>
    <% end %>

    <!-- Attachments -->
    <% if @attachments.present? %>
      <h3 style="margin-top: 36px; margin-bottom: 12px;">
        Attachments
      </h3>

      <% @attachments.each do |asset| %>
        <% blob = asset.file.blob %>

        <span style="margin-bottom: 6px;">
            <a
              href="<%= rails_blob_url(blob, disposition: "inline") %>"
              target="_blank"
              style="color:#2563eb; text-decoration: underline;"
            >
              <% if blob.image? %>
                <a href="<%= rails_blob_url(blob, disposition: "inline") %>" target="_blank">
                  <img
                    src="<%= rails_blob_url(blob, disposition: "inline") %>"
                    alt="<%= blob.filename %>"
                    width="180"
                    style="display:block;margin:6px 0;border-radius:4px;"
                    />
                  <%= blob.filename.to_s %>
                </a>
              <% else %>
                <%= blob.filename.to_s %>
              <% end %>
            </a>
          </span>
      <% end %>
    <% end %>
  <% end %>
</div>

<hr style="margin: 24px 0;">

<p>
  <%= link_to "View report",
              workshop_log_url(@report),
              style: "display:inline-block;
                      padding:10px 16px;
                      background:#2563eb;
                      color:#ffffff;
                      text-decoration:none;
                      border-radius:6px;
                      font-weight:bold;" if @report.present? %>

  <a href="<%= profile_url %>"
     style="display:inline-block;background:#e5e7eb;color:#111827;
       text-decoration:none;padding:10px 16px;border-radius:6px;
       font-weight:bold;">
    View profile
  </a>
</p>
