<%= turbo_stream.replace("community_news_count", partial: "community_news_count") %>
<% if @community_news.any? %>
  <div class="overflow-x-auto bg-white border border-gray-200 rounded-xl shadow-sm blur-on-submit">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Title</th>
          <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Author</th>
          <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Project</th>
          <th class="px-6 py-3 text-center text-sm font-semibold text-gray-700">Updated</th>
          <th class="px-6 py-3 text-center text-sm font-semibold text-gray-700">Actions</th>
        </tr>
      </thead>

      <tbody class="divide-y divide-gray-100">
        <% @community_news.each do |news| %>
          <tr class="hover:bg-gray-50 transition">
            <td class="px-4 py-2 text-sm text-gray-800 flex items-center gap-2">
              <!-- BOOKMARK -->
              <span class="pointer-events-auto">
                <%= render "bookmarks/editable_bookmark_icon", resource: news.object %>
              </span>

              <!-- Assets -->
              <%= render "assets/display_image",
                          resource: news,
                          width: 24, height: 14,
                          variant: :index,
                          link_to_object: true,
                          file: news.display_image %>

              <!-- TITLE + BADGES -->
              <span class="inline-flex items-center gap-2">
                <%= link_to title_with_badges(news, show_hidden_badge: current_user.super_user?).html_safe,
                              community_news_path(news),
                              data: { turbo_prefetch: false, turbo_frame: "_top" },
                              target: news.external_link? ? "_blank" : "", rel: "noopener noreferrer",
                              class: "font-bold hover:text-indigo-800 hover:underline" %>
              </span>
            </td>

            <td class="px-6 py-4 text-gray-800"><%= news.author&.full_name || "—" %></td>

            <td class="px-6 py-4 text-gray-600"><%= news.project&.name || "—" %></td>

            <td class="px-6 py-4 text-center text-sm text-gray-500"><%= news.updated_at.strftime("%b %d, %Y") %></td>

            <td class="px-6 py-4 text-right">
              <div class="inline-flex gap-2">
                <% if current_user.super_user? %>
                  <%= link_to "Edit",
                                edit_community_news_path(news),
                                data: {turbo_frame: "_top"},
                                class: "admin-only bg-blue-100 btn btn-secondary-outline" %>
                <% end %>

                <%= link_to "View",
                              community_news_path(news),
                              target: news.external_link? ? "_blank" : "", rel: "noopener noreferrer",
                              class: "btn btn-secondary-outline" %>
              </div>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
  <!-- Pagination -->
  <div class="mt-6 flex justify-center">
    <div class="pagination mt-6"><%= tailwind_paginate @community_news %></div>
  </div>
<% else %>
  <div class="text-center py-16 bg-white rounded-xl border border-gray-200 shadow-sm">
    <h2 class="text-gray-600 text-lg mb-2">No community news yet</h2>

    <% if current_user.super_user? %>
      <div class="admin-only bg-blue-100 p-3">
        <%= link_to "Create a post",
                        new_community_news_path,
                        class: "btn btn-primary" %>
      </div>
    <% end %>
  </div>
<% end %>
