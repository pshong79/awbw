<% if @stories.any? %>
  <div class="overflow-x-auto bg-white border border-gray-200 rounded-xl shadow-sm">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Title</th>
          <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Windows Type</th>
          <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Workshop</th>
          <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Author</th>
          <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Project</th>
          <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Updated At</th>
          <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Actions</th>
        </tr>
      </thead>

      <tbody class="divide-y divide-gray-100">
        <% @stories.each do |story| %>
          <tr class="hover:bg-gray-50">
            <td class="px-4 py-2 text-sm text-gray-800 flex items-center gap-2">
              <!-- BOOKMARK -->
              <span class="pointer-events-auto"><%= render "bookmarks/editable_bookmark_icon", resource: story %></span>

              <%= render "assets/display_image",
                               resource: story,
                               width: 24, height: 14,
                               variant: :index,
                               link_to_object: true,
                               file: story.display_image %>

              <!-- TITLE + BADGES -->
              <span class="inline-flex items-center gap-2">
                <%= link_to title_with_badges(story, show_hidden_badge: current_user.super_user?).html_safe,
                                  story_path(story),
                                  target: story.external_link? ? "_blank" : "", rel: "noopener noreferrer",
                                  class: "font-bold hover:text-indigo-800 hover:underline" %>
              </span>
            </td>

            <td class="px-4 py-2 text-sm text-gray-800"><%= story.windows_type&.short_name %></td>

            <td class="px-4 py-2 text-sm text-gray-800">
              <span title="<%= story.workshop&.title %>"><%= story.workshop&.title&.truncate(30) %></span>
            </td>

            <td class="px-4 py-2 text-sm text-gray-800"><%= story.created_by.name %></td>

            <td class="px-4 py-2 text-sm text-gray-800">
              <span title="<%= story.project&.name %>"><%= story.project&.name&.truncate(30) %></span>
            </td>

            <td class="px-4 py-2 text-sm text-gray-500"><%= story.updated_at.strftime("%b %d, %Y") %></td>

            <td class="px-4 py-2 text-sm text-gray-500">
              <%= link_to "View",
                                story_path(story, no_redirect: true),
                                target: story.external_link? ? "_blank" : "", rel: "noopener noreferrer",
                                class: "btn btn-secondary-outline" %>

              <% if current_user.super_user? %>
                <%= link_to "Edit", edit_story_path(story),
                                  data: {turbo_frame: "_top"},
                                  class: "admin-only bg-blue-100 btn btn-secondary-outline" %>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
  <!-- Pagination -->
  <div class="mt-6 flex justify-center">
    <div class="pagination mt-6"><%= tailwind_paginate @stories %></div>
  </div>
<% else %>
  <div class="text-center py-16 bg-white rounded-xl border border-gray-200 shadow-sm">
    <h2 class="text-gray-600 text-lg mb-2">No stories found</h2>

    <% if current_user.super_user? %>
      <div class="admin-only bg-blue-100 p-3">
        <%= link_to "Create a story",
                            new_story_path,
                            data: {turbo_frame: "_top"},
                            class: "btn btn-primary" %>
      </div>
    <% end %>
  </div>
<% end %>
