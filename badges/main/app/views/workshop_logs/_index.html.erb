<div class="min-h-screen py-8">
  <div class="max-w-full mx-auto px-4 sm:px-6 lg:px-8">
    <div class="max-w-7xl mx-auto bg-white border border-gray-200 rounded-xl shadow-lg hover:shadow-xl
    transition-shadow duration-200 p-6">
      <div class="space-y-6">
        <!-- Header -->
        <div class="flex items-center justify-between mb-6">
          <h1 class="text-2xl font-semibold text-gray-900">
            <%= WorkshopLog.model_name.human.pluralize %> (<%= number_with_delimiter(@workshop_logs_count) %>)
          </h1>
          <div class="flex gap-2">
            <%= link_to "New #{WorkshopLog.model_name.human.downcase}",
                        new_workshop_log_path(project_id: params[:project_id],
                                              workshop_id: params[:workshop_id],
                                              user_id: current_user.id),
                        class: "btn btn-primary" %>
          </div>
        </div>

        <!-- Filter form -->
        <%= render "workshop_logs/search_boxes" %>

        <div class="overflow-x-auto">
          <table class="table normal light table-striped js-workshop-logs">
            <thead>
            <!-- Top-tier grouping -->
            <tr>
              <th colspan="4"></th>
              <th colspan="3" class="px-4 py-2 text-center text-sm font-semibold text-white bg-blue-500"># Ongoing</th>
              <th colspan="3" class="px-4 py-2 text-center text-sm font-semibold text-white bg-green-500"># First-time</th>
            </tr>

            <!-- Second-tier column headers -->
            <tr class="bg-gray-100">
              <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Date</th>
              <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Workshop</th>
              <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Facilitator</th>
              <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700 bg-purple-200">Participants</th>

              <!-- Ongoing -->
              <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700 bg-blue-200">children</th>
              <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700 bg-blue-200">teens</th>
              <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700 bg-blue-200">adults</th>

              <!-- First-time -->
              <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700 bg-green-200">children</th>
              <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700 bg-green-200">teens</th>
              <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700 bg-green-200">adults</th>

              <th class="px-4 py-2 text-center text-sm font-semibold text-gray-700">Action</th>
            </tr>
            </thead>

            <tbody class="divide-y divide-gray-200">
            <% page_totals = {
              children_ongoing: 0,
              teens_ongoing: 0,
              adults_ongoing: 0,
              children_first_time: 0,
              teens_first_time: 0,
              adults_first_time: 0
            } %>

            <% @workshop_logs.each do |log| %>
              <% page_totals[:children_ongoing]  += log.children_ongoing.to_i %>
              <% page_totals[:teens_ongoing]     += log.teens_ongoing.to_i %>
              <% page_totals[:adults_ongoing]    += log.adults_ongoing.to_i %>
              <% page_totals[:children_first_time] += log.children_first_time.to_i %>
              <% page_totals[:teens_first_time]    += log.teens_first_time.to_i %>
              <% page_totals[:adults_first_time]   += log.adults_first_time.to_i %>

              <tr class="hover:bg-gray-50 transition-colors duration-150">
                <td class="px-2 text-left text-xs whitespace-nowrap">
                  <%= link_to (log.date || log.created_at)&.strftime("%b %d, %Y"), workshop_log_path(log) %>
                </td>
                <td class="px-2 text-left text-sm font-bold">
                  <%= log.workshop ? link_to(log.workshop.title, workshop_path(log.workshop)) : "-" %>
                </td>
                <td class="px-2 text-left text-xs">
                  <%= log.user ? link_to(log.user.name, generate_facilitator_user_path(log.user)) : "â€”" %>
                </td>

                <td class="text-center font-bold text-lg bg-purple-100"><%= display_count(log.total_attendance) %></td>

                <!-- Ongoing -->
                <td class="text-center bg-blue-100"><%= display_count(log.children_ongoing) %></td>
                <td class="text-center bg-blue-100"><%= display_count(log.teens_ongoing) %></td>
                <td class="text-center bg-blue-100"><%= display_count(log.adults_ongoing) %></td>

                <!-- First-time -->
                <td class="text-center bg-green-100"><%= display_count(log.children_first_time) %></td>
                <td class="text-center bg-green-100"><%= display_count(log.teens_first_time) %></td>
                <td class="text-center bg-green-100"><%= display_count(log.adults_first_time) %></td>

                <td class="text-center whitespace-nowrap">
                  <% if current_user.super_user? || log.user == current_user %>
                    <%= link_to "Edit",
                                edit_workshop_log_path(log),
                                class: "btn btn-secondary-outline text-xs px-2 py-1" %>
                  <% end %>
                  <%= link_to "View",
                              workshop_log_path(log),
                              class: "btn btn-secondary-outline text-xs px-2 py-1" %>
                </td>
              </tr>
            <% end %>

            </tbody>

            <tfoot>
            <% if @workshop_logs_count > @per_page.to_i %>
              <!-- Subtotal for this page -->
              <tr class="font-semibold text-sm bg-gray-50 border-t border-gray-300">
                <td colspan="3" class="text-right pr-2 text-sm font-semibold text-gray-700">Subtotal (this page):</td>
                <td class="text-center font-bold text-lg bg-purple-200 text-gray-900">
                  <%= page_totals.values.sum %>
                </td>

                <td class="text-center font-bold text-lg bg-blue-200 text-gray-900"><%= page_totals[:children_ongoing] %></td>
                <td class="text-center font-bold text-lg bg-blue-200 text-gray-900"><%= page_totals[:teens_ongoing] %></td>
                <td class="text-center font-bold text-lg bg-blue-200 text-gray-900"><%= page_totals[:adults_ongoing] %></td>

                <td class="text-center font-bold text-lg bg-green-200 text-gray-900"><%= page_totals[:children_first_time] %></td>
                <td class="text-center font-bold text-lg bg-green-200 text-gray-900"><%= page_totals[:teens_first_time] %></td>
                <td class="text-center font-bold text-lg bg-green-200 text-gray-900"><%= page_totals[:adults_first_time] %></td>
              </tr>
            <% end %>
            <!-- Grant total -->
            <tr class="bold small">
              <% grand_total_text = "Grand Total#{ " (all pages)" if @workshop_logs_count > @per_page.to_i }" %>
              <td colspan="3" class="text-right pr-2 text-sm font-semibold"><%= grand_total_text %>:</td>
              <td class="text-center font-bold text-xl text-white bg-purple-500">
                <%= @workshop_logs_unpaginated.sum(:children_ongoing) +
                      @workshop_logs_unpaginated.sum(:teens_ongoing) +
                      @workshop_logs_unpaginated.sum(:adults_ongoing) +
                      @workshop_logs_unpaginated.sum(:children_first_time) +
                      @workshop_logs_unpaginated.sum(:teens_first_time) +
                      @workshop_logs_unpaginated.sum(:adults_first_time) %>
              </td>
              <td class="text-center font-bold text-xl text-white bg-blue-500">
                <%= @workshop_logs_unpaginated.sum(:children_ongoing) %>
              </td>
              <td class="text-center font-bold text-xl text-white bg-blue-500">
                <%= @workshop_logs_unpaginated.sum(:teens_ongoing) %>
              </td>
              <td class="text-center font-bold text-xl text-white bg-blue-500">
                <%= @workshop_logs_unpaginated.sum(:adults_ongoing) %>
              </td>
              <td class="text-center font-bold text-xl text-white bg-green-500">
                <%= @workshop_logs_unpaginated.sum(:children_first_time) %>
              </td>
              <td class="text-center font-bold text-xl text-white bg-green-500">
                <%= @workshop_logs_unpaginated.sum(:teens_first_time) %>
              </td>
              <td class="text-center font-bold text-xl text-white bg-green-500">
                <%= @workshop_logs_unpaginated.sum(:adults_first_time) %>
              </td>
            </tr>
            </tfoot>
          </table>
        </div>

        <!-- Empty state -->
        <% unless @workshop_logs.any? %>
          <p class="text-gray-500 text-center py-6">
            No <%= WorkshopLog.model_name.human.pluralize %> found.
          </p>
        <% end %>

        <!-- Pagination -->
        <div class="mt-6 flex justify-center">
          <div class="pagination">
            <%= tailwind_paginate @workshop_logs %>
          </div>
        </div>

        <div class="mt-8 flex justify-end">
          <%= render "workshop_logs/index_per_page" %>
        </div>
      </div>
    </div>
  </div>
</div>
