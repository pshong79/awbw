<div class="rounded-xl bg-white p-6">
  <%= simple_form_for(@workshop_log) do |f| %>
  <%= f.input :user_id, as: :hidden, input_html: { value: params[:user_id] || current_user.id } %>
  <%= f.input :windows_type_id, as: :hidden, input_html: { value: @windows_type_id } %>

  <!-- Error messages -->
  <% if f.object.errors.any? %>
    <div class="mb-4 p-3 bg-red-50 border border-red-200 rounded-md text-red-700 text-sm">
      <%= f.object.errors.full_messages.to_sentence %>
    </div>
  <% end %>

  <!-- Workshop Selection -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
    <%= f.input :workshop_id,
                as: :select,
                collection: @workshops,
                label_method: :type_name,
                value_method: :id,
                label: "Workshop",
                prompt: "Select a Workshop",
                required: true,
                selected: params[:workshop_id].presence || f.object.workshop_id,
                input_html: { value: params[:workshop_id].presence || f.object.workshop_id,
                              class: "block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500" },
                label_html: { class: "block text-sm font-medium text-gray-700 mb-1" } %>

    <%= f.input :project_id,
                as: :select,
                collection: @agencies,
                label_method: :type_name,
                value_method: :id,
                label: "Organization",
                required: true,
                hint: "Please contact AWBW if your agency is not listed.",
                prompt: (@agencies.count > 1 ? "Please select the relevant agency" : nil),
                selected: (params[:project_id].presence || (f.object.project_id || (@agencies.count == 1 ? @agencies.first.id : nil))),
                input_html: { value: params[:project_id].presence || f.object.project_id || @agency_id,
                              class: "block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500" },
                label_html: { class: "block text-sm font-medium text-gray-700 mb-1" } %>
    <%= f.input :date,
                label: "Workshop Date",
                as: :string,
                required: true,
                input_html: { type: 'date', value: f.object.date&.strftime('%Y-%m-%d'),
                              class: "block w-fullrounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500" },
                label_html: { class: "block text-sm font-medium text-gray-700 mb-1" } %>
  </div>


  <!-- Participants Section -->
  <hr class="my-6 border-gray-200">
  <h2 class="text-lg font-semibold text-gray-800 mb-2">Participants</h2>

  <!-- Ongoing Participants -->
  <div class="mb-6">
    <label class="block text-sm font-medium text-gray-700 mb-2">
      Ongoing participants
      <span class="text-xs text-gray-500">(have attended an AWBW workshop before)</span>
    </label>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
      <%= f.input :children_ongoing, as: :integer, label: "Children (0–12)",
                  input_html: {
                    min: 0,
                    class: "block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500" } %>
      <%= f.input :teens_ongoing, as: :integer, label: "Teens (13–17)",
                  input_html: {
                    min: 0,
                    class: "block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500" } %>
      <%= f.input :adults_ongoing, as: :integer, label: "Adults (18+)",
                  input_html: {
                    min: 0,
                    class: "block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500" } %>
    </div>
  </div>

  <!-- First-Time Participants -->
  <div class="mb-6">
    <label class="block text-sm font-medium text-gray-700 mb-2">
      First-time participants
      <span class="text-xs text-gray-500">(have never attended an AWBW workshop)</span>
    </label>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
      <%= f.input :children_first_time, as: :integer, label: "Children (0–12)", input_html: { min: 0, class: "block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500" } %>
      <%= f.input :teens_first_time, as: :integer, label: "Teens (13–17)", input_html: { min: 0, class: "block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500" } %>
      <%= f.input :adults_first_time, as: :integer, label: "Adults (18+)", input_html: { min: 0, class: "block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500" } %>
    </div>
  </div>

  <!-- Quotes Section -->
  <hr class="my-6 border-gray-200">
  <h2 class="text-lg font-semibold text-gray-800 mb-2">Quotes from participants</h2>
  <p class="text-sm text-gray-600 mb-3">
    What did your participants share about their experience? Please write quotes in first person.
  </p>
  <div id="quotes" class="space-y-3">
    <%= f.simple_fields_for :all_quotable_item_quotes do |qiq_form| %>
      <%= render 'quotable_item_quote_fields', f: qiq_form %>
    <% end %>
    <%= link_to_add_association "Add Quote", f, :quotable_item_quotes, class: "text-blue-600 hover:underline text-sm" %>
  </div>

  <!-- Upload Section -->
  <%= render "shared/form_image_fields", f: f, include_primary_asset: false,
             section_title: "Upload Images / Media Releases",
             section_subtitle: "Attach photos, PDFs, or signed media release forms" %>

  <!-- Submit -->
  <div class="mt-8 flex justify-center gap-3">
    <% if  @workshop_log.persisted? && current_user.super_user? %>
      <%= link_to "Delete", @workshop_log, class: "btn btn-danger-outline",
                  method: :delete, data: { confirm: "Are you sure?" } %>
    <% end %>
    <%= link_to "Cancel", workshop_logs_path, class: "btn btn-secondary-outline" %>
    <%= f.button :submit, "Save Log", class: "btn btn-primary" %>
  </div>
<% end %>
</div>
